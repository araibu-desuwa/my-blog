<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的個人部落格</title>
    <link rel="stylesheet" href="style.css">
</head>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, orderBy, query, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";

  // 1. 保留你的 config
  const firebaseConfig = {
  apiKey: "AIzaSyDh1mj2ffe0PG5Aje-eVN8-zRzk_6Uq9ss",
  authDomain: "araibu-desuwa.firebaseapp.com",
  projectId: "araibu-desuwa",
  storageBucket: "araibu-desuwa.firebasestorage.app",
  messagingSenderId: "966349364339",
  appId: "1:966349364339:web:a68b65d8bf4e87209c5e06",
  measurementId: "G-F7P56KSMMJ"
};

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  // --- 主題切換功能 ---
  window.toggleTheme = function() {
    document.body.classList.toggle('dark-mode');
    // 把選擇存起來，下次打開網頁就不用重新選
    const isDark = document.body.classList.contains('dark-mode');
    localStorage.setItem('darkMode', isDark);
  }

  // 檢查上次存的主題設定
  if (localStorage.getItem('darkMode') === 'true') {
    document.body.classList.add('dark-mode');
  }

  // --- 載入文章 (增加刪除按鈕) ---
  async function loadPosts() {
    const postContainer = document.querySelector('.content');
    const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
    const querySnapshot = await getDocs(q);
    
    const publishArea = document.querySelector('.publish-area');
    postContainer.innerHTML = '';
    postContainer.appendChild(publishArea);

    querySnapshot.forEach((documentSnapshot) => {
      const post = documentSnapshot.data();
      const postId = documentSnapshot.id; // 取得文章 ID 用於刪除
      
      const postElement = document.createElement('article');
      postElement.className = 'post';
      postElement.innerHTML = `
        <button class="btn-delete" onclick="deletePost('${postId}')">刪除</button>
        ${post.imageUrl ? `<img src="${post.imageUrl}" style="max-width:100%; border-radius:8px; margin-bottom:15px;">` : ''}
        <h2>${post.title}</h2>
        <p class="meta">${new Date(post.createdAt?.toDate()).toLocaleString()}</p>
        <p>${post.content}</p>
      `;
      postContainer.appendChild(postElement);
    });
  }

  // --- 刪除文章功能 ---
  window.deletePost = async function(id) {
    if (confirm("確定要刪除這篇靈感嗎？")) {
      try {
        await deleteDoc(doc(db, "posts", id));
        alert("刪除成功！");
        location.reload();
      } catch (e) {
        alert("刪除失敗：" + e.message);
      }
    }
  }

  // --- 發布功能 (同之前) ---
  window.addPost = async function() {
    /* ... 你原本的 addPost 代碼 ... */
  }

  loadPosts();
</script>

<body>

    <header>
        <h1>🌟 探索生活日誌</h1>
        <p>分享科技、生活與創意的地方</p>
    </header>

    <nav>
        <a href="#">首頁</a>
        <a href="#">關於我</a>
        <a href="#">文章分類</a>
        <a href="#">聯絡我們</a>
    </nav>

<section class="publish-area">
    <h3>✨ 紀錄新靈感</h3>
    <input type="text" id="post-title" placeholder="請輸入文章標題...">
    <textarea id="post-content" rows="4" placeholder="今天有什麼靈感嗎？"></textarea>
    
    <div class="upload-box">
        <label for="image-upload" class="custom-file-upload">
            📷 上傳靈感圖片
        </label>
        <input id="image-upload" type="file" accept="image/*" onchange="previewImage(event)">
        <img id="preview" src="#" alt="預覽圖片" style="display:none; max-width:100%; margin-top:10px; border-radius:5px;">
    </div>
    
    <button onclick="addPost()" class="btn-submit">發布文章</button>
</section>

    <div class="container">
        <main class="content">
            <article class="post">
                <h2>如何開始學習網頁設計？</h2>
                <p class="meta">發布日期：2026年2月6日 | 分類：教學</p>
                <p>學習網頁設計的第一步是掌握 HTML 和 CSS。這兩者就像是建築物的骨架與裝潢...</p>
                <a href="#" class="read-more">閱讀全文</a>
            </article>

            <article class="post">
                <h2>我的第一篇部落格文章</h2>
                <p class="meta">發布日期：2026年2月1日 | 分類：隨筆</p>
                <p>今天終於架設好了我的部落格！這是一個令人興奮的開始...</p>
                <a href="#" class="read-more">閱讀全文</a>
            </article>
        </main>

        <aside class="sidebar">
            <h3>關於作者</h3>
            <p>你好！我是 Gemini，熱愛科技與寫作的 AI 助手。</p>
            <h3>熱門標籤</h3>
            <ul>
                <li>#HTML</li>
                <li>#CSS</li>
                <li>#生活隨筆</li>
            </ul>
        </aside>
    </div>

    <footer>
        <p>&copy; 2026 我的部落格. 版權所有.</p>
    </footer>

</body>
</html>