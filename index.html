<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„å€‹äººéƒ¨è½æ ¼</title>
    <link rel="stylesheet" href="style.css">
</head>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, orderBy, query } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";

  // 1. é€™è£¡è«‹ä¿ç•™ä½ åŸæœ¬çš„ config
  const firebaseConfig = {
  apiKey: "AIzaSyDh1mj2ffe0PG5Aje-eVN8-zRzk_6Uq9ss",
  authDomain: "araibu-desuwa.firebaseapp.com",
  projectId: "araibu-desuwa",
  storageBucket: "araibu-desuwa.firebasestorage.app",
  messagingSenderId: "966349364339",
  appId: "1:966349364339:web:a68b65d8bf4e87209c5e06",
  measurementId: "G-F7P56KSMMJ"
};

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  // --- è¼‰å…¥æ–‡ç«  (å«åœ–ç‰‡é¡¯ç¤º) ---
  async function loadPosts() {
    const postContainer = document.querySelector('.content');
    const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
    const querySnapshot = await getDocs(q);
    
    const publishArea = document.querySelector('.publish-area');
    postContainer.innerHTML = '';
    postContainer.appendChild(publishArea);

    querySnapshot.forEach((doc) => {
      const post = doc.data();
      const postElement = document.createElement('article');
      postElement.className = 'post';
      postElement.innerHTML = `
        ${post.imageUrl ? `<img src="${post.imageUrl}" style="max-width:100%; border-radius:8px; margin-bottom:15px;">` : ''}
        <h2>${post.title}</h2>
        <p class="meta">${new Date(post.createdAt?.toDate()).toLocaleString()}</p>
        <p>${post.content}</p>
      `;
      postContainer.appendChild(postElement);
    });
  }

  // --- ç™¼å¸ƒæ–‡ç«  + åœ–ç‰‡ä¸Šå‚³ ---
  window.addPost = async function() {
    const title = document.getElementById('post-title').value;
    const content = document.getElementById('post-content').value;
    const imageFile = document.getElementById('image-upload').files[0];

    if (!title || !content) return alert("è«‹å¡«å¯«æ¨™é¡Œå’Œå…§å®¹");

    let imageUrl = "";

    try {
      // å¦‚æœæœ‰é¸æ“‡åœ–ç‰‡ï¼Œå…ˆä¸Šå‚³åœ–ç‰‡åˆ° Storage
      if (imageFile) {
        const storageRef = ref(storage, 'images/' + Date.now() + "_" + imageFile.name);
        const snapshot = await uploadBytes(storageRef, imageFile);
        imageUrl = await getDownloadURL(snapshot.ref);
      }

      // å°‡è³‡æ–™å­˜å…¥ Firestore
      await addDoc(collection(db, "posts"), {
        title: title,
        content: content,
        imageUrl: imageUrl, // å­˜å…¥åœ–ç‰‡ç¶²å€
        createdAt: new Date()
      });

      alert("ç™¼å¸ƒæˆåŠŸï¼");
      location.reload();
    } catch (e) {
      console.error("éŒ¯èª¤è³‡è¨Š: ", e);
      alert("ç™¼å¸ƒå¤±æ•—ï¼Œè«‹æª¢æŸ¥ Firebase Storage æ¬Šé™");
    }
  }

  loadPosts();
</script>

<body>

    <header>
        <h1>ğŸŒŸ æ¢ç´¢ç”Ÿæ´»æ—¥èªŒ</h1>
        <p>åˆ†äº«ç§‘æŠ€ã€ç”Ÿæ´»èˆ‡å‰µæ„çš„åœ°æ–¹</p>
    </header>

    <nav>
        <a href="#">é¦–é </a>
        <a href="#">é—œæ–¼æˆ‘</a>
        <a href="#">æ–‡ç« åˆ†é¡</a>
        <a href="#">è¯çµ¡æˆ‘å€‘</a>
    </nav>

<section class="publish-area">
    <h3>âœ¨ ç´€éŒ„æ–°éˆæ„Ÿ</h3>
    <input type="text" id="post-title" placeholder="è«‹è¼¸å…¥æ–‡ç« æ¨™é¡Œ...">
    <textarea id="post-content" rows="4" placeholder="ä»Šå¤©æœ‰ä»€éº¼éˆæ„Ÿå—ï¼Ÿ"></textarea>
    
    <div class="upload-box">
        <label for="image-upload" class="custom-file-upload">
            ğŸ“· ä¸Šå‚³éˆæ„Ÿåœ–ç‰‡
        </label>
        <input id="image-upload" type="file" accept="image/*" onchange="previewImage(event)">
        <img id="preview" src="#" alt="é è¦½åœ–ç‰‡" style="display:none; max-width:100%; margin-top:10px; border-radius:5px;">
    </div>
    
    <button onclick="addPost()" class="btn-submit">ç™¼å¸ƒæ–‡ç« </button>
</section>

    <div class="container">
        <main class="content">
            <article class="post">
                <h2>å¦‚ä½•é–‹å§‹å­¸ç¿’ç¶²é è¨­è¨ˆï¼Ÿ</h2>
                <p class="meta">ç™¼å¸ƒæ—¥æœŸï¼š2026å¹´2æœˆ6æ—¥ | åˆ†é¡ï¼šæ•™å­¸</p>
                <p>å­¸ç¿’ç¶²é è¨­è¨ˆçš„ç¬¬ä¸€æ­¥æ˜¯æŒæ¡ HTML å’Œ CSSã€‚é€™å…©è€…å°±åƒæ˜¯å»ºç¯‰ç‰©çš„éª¨æ¶èˆ‡è£æ½¢...</p>
                <a href="#" class="read-more">é–±è®€å…¨æ–‡</a>
            </article>

            <article class="post">
                <h2>æˆ‘çš„ç¬¬ä¸€ç¯‡éƒ¨è½æ ¼æ–‡ç« </h2>
                <p class="meta">ç™¼å¸ƒæ—¥æœŸï¼š2026å¹´2æœˆ1æ—¥ | åˆ†é¡ï¼šéš¨ç­†</p>
                <p>ä»Šå¤©çµ‚æ–¼æ¶è¨­å¥½äº†æˆ‘çš„éƒ¨è½æ ¼ï¼é€™æ˜¯ä¸€å€‹ä»¤äººèˆˆå¥®çš„é–‹å§‹...</p>
                <a href="#" class="read-more">é–±è®€å…¨æ–‡</a>
            </article>
        </main>

        <aside class="sidebar">
            <h3>é—œæ–¼ä½œè€…</h3>
            <p>ä½ å¥½ï¼æˆ‘æ˜¯ Geminiï¼Œç†±æ„›ç§‘æŠ€èˆ‡å¯«ä½œçš„ AI åŠ©æ‰‹ã€‚</p>
            <h3>ç†±é–€æ¨™ç±¤</h3>
            <ul>
                <li>#HTML</li>
                <li>#CSS</li>
                <li>#ç”Ÿæ´»éš¨ç­†</li>
            </ul>
        </aside>
    </div>

    <footer>
        <p>&copy; 2026 æˆ‘çš„éƒ¨è½æ ¼. ç‰ˆæ¬Šæ‰€æœ‰.</p>
    </footer>

</body>
</html>